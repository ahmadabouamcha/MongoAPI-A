<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>School Manager — MongoAPI UI</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa4b2; --accent:#60a5fa; --accent-2:#7dd3fc; --glass:rgba(255,255,255,0.03);
      --radius:12px; --maxw:980px; font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071428 0%, #071428 55%, #031021 100%);color:#e6eef7;display:flex;align-items:flex-start;justify-content:center;padding:28px}
    .app{width:100%;max-width:var(--maxw)}
    header{display:flex;align-items:center;gap:16px;margin-bottom:20px}
    .brand{display:flex;flex-direction:column}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    nav{display:flex;gap:8px;margin-left:auto}
    button.tab{background:transparent;border:0;color:var(--muted);padding:8px 12px;border-radius:10px;cursor:pointer}
    button.tab.active{background:linear-gradient(90deg,var(--glass), rgba(255,255,255,0.02));color:var(--accent)}

    .grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:var(--radius);box-shadow:0 6px 18px rgba(2,6,23,0.6);}
    .card h2{margin:0 0 12px 0;font-size:16px}
    .list{display:flex;flex-direction:column;gap:8px;max-height:58vh;overflow:auto;padding-right:6px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:rgba(255,255,255,0.01);}
    .meta{display:flex;flex-direction:column}
    .meta .title{font-weight:600}
    .meta .sub{font-size:12px;color:var(--muted)}
    .controls{display:flex;gap:8px}
    .btn{border:0;padding:8px 10px;border-radius:8px;cursor:pointer}
    .btn.primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#04263b}
    .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}

    form.row{display:flex;gap:8px}
    input, select{background:transparent;border:1px solid rgba(255,255,255,0.05);padding:8px;border-radius:8px;color:inherit}
    label{font-size:12px;color:var(--muted)}
    small.msg{display:block;color:var(--muted);margin-top:8px}

    /* right column */
    .panel{position:sticky;top:28px}
    .panel .section{margin-bottom:14px}

    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

    /* responsive */
    @media (max-width:900px){
      .grid{grid-template-columns:1fr;}
      .panel{position:static}
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <h1>School Manager</h1>
        <p class="lead">Simple UI for your MongoAPI (courses & students)</p>
      </div>
      <nav>
        <button class="tab active" data-tab="courses">Courses</button>
        <button class="tab" data-tab="students">Students</button>
      </nav>
    </header>

    <div class="grid">
      <div id="main" class="card">
        <!-- content injected by JS -->
      </div>

      <aside class="panel">
        <div class="card">
          <div class="section">
            <h2>Quick Actions</h2>
            <div style="display:flex;gap:8px;margin-top:10px">
              <button id="btn-seed" class="btn ghost">Seed Data</button>
              <button id="btn-refresh" class="btn ghost">Refresh</button>
            </div>
            <small class="msg">API: <span id="api-url"></span></small>
            <small class="msg">Status: <span id="api-status">unknown</span></small>
          </div>

          <div class="section">
            <h2>Add New</h2>
            <div style="display:flex;flex-direction:column;gap:8px">
              <div>
                <label>Course title</label>
                <input id="new-course-title" placeholder="Intro to Programming" />
                <input id="new-course-code" placeholder="CS101" style="margin-top:6px" />
                <button id="btn-add-course" class="btn primary" style="margin-top:8px">Add Course</button>
              </div>

              <div>
                <label>Student name</label>
                <input id="new-student-name" placeholder="Jane Doe" />
                <input id="new-student-email" placeholder="jane@example.com" style="margin-top:6px" />
                <button id="btn-add-student" class="btn primary" style="margin-top:8px">Add Student</button>
              </div>
            </div>
          </div>

        </div>
      </aside>
    </div>

    <footer>
      <small>Built to work with your API at <span id="footer-url"></span>. Edit <code>BASE_URL</code> in script to point somewhere else.</small>
    </footer>
  </div>

  <script>
    // ---- CONFIG ----
    const BASE_URL = 'https://mongoapi-a.onrender.com'; // <--- your API base URL
    document.getElementById('api-url').textContent = BASE_URL;
    document.getElementById('footer-url').textContent = BASE_URL;

    // ---- helper ----
    function el(tag, attrs={}, ...children){const e=document.createElement(tag);Object.entries(attrs).forEach(([k,v])=>{if(k==='class')e.className=v;else if(k==='html')e.innerHTML=v;else e.setAttribute(k,v)});children.flat().forEach(c=>{if(c==null) return; e.append(typeof c === 'string' ? document.createTextNode(c) : c)});return e}

    async function api(path, opts={}){
      try{
        const res = await fetch(BASE_URL + path, Object.assign({headers:{'Content-Type':'application/json'}}, opts));
        if(!res.ok){const text=await res.text(); throw new Error(res.status + ' ' + text)}
        return await res.json();
      }catch(err){console.error('API',path,err);throw err}
    }

    // ---- state ----
    let courses = [];
    let students = [];
    let activeTab = 'courses';

    // ---- DOM targets ----
    const main = document.getElementById('main');

    // ---- renderers ----
   function renderCourses(){
  main.innerHTML='';
  const header = el('div',{}, el('h2',{},'Courses'));
  const list = el('div',{class:'list'});

  if(courses.length===0)
    list.append(el('div',{class:'item'}, el('div',{},'No courses found')));

  courses.forEach(c=>{
    const item = el(
      'div',
      { class: 'item' },
      el(
        'div',
        { class: 'meta' },
        el('div', { class: 'title' }, c.title),
        el('div', { class: 'sub' }, c.code)
      ),
      el(
        'div',
        { class: 'controls' },           // ✅ Fixed here
        el('button', { class: 'btn ghost', onclick: () => viewCourse(c._id) }, 'View'),
        el('button', { class: 'btn ghost', onclick: () => deleteCourse(c._id) }, 'Delete')
      )
    );
    list.append(item);
  });

  main.append(header, list);
}

    function renderStudents(){
      main.innerHTML='';
      const header = el('div',{}, el('h2',{},'Students'));
      const list = el('div',{class:'list'});
      if(students.length===0) list.append(el('div',{class:'item'}, el('div',{},'No students found')));
      students.forEach(s=>{
        const item = el('div',{class:'item'},
          el('div',{class:'meta'}, el('div',{class:'title'},s.name), el('div',{class:'sub'}, s.email || '—')),
          el('div',{class:'controls'},
            el('button',{class:'btn ghost', onclick:()=>viewStudent(s._id)},'View'),
            el('button',{class:'btn ghost', onclick:()=>deleteStudent(s._id)},'Delete')
          )
        );
        list.append(item);
      });
      main.append(header, list);
    }

    // ---- actions ----
    async function loadAll(){
      try{
        const [c,s] = await Promise.all([api('/api/courses'), api('/api/students')]);
        courses = c; students = s;
        if(activeTab==='courses') renderCourses(); else renderStudents();
        document.getElementById('api-status').textContent = 'OK';
      }catch(err){document.getElementById('api-status').textContent = 'Error'; main.innerHTML = '<p style="color:#fca5a5">Failed to load data. Check API and CORS.</p>'}
    }

    async function viewCourse(id){
      try{
        const course = await api('/api/courses/' + id);
        main.innerHTML = '';
        const card = el('div',{}, el('h2',{}, course.title), el('p',{class:'lead'}, 'Code: ' + course.code));
        const registered = students.filter(s => (s.registeredCourses || []).some(rc => rc.courseId === course._id));
        const list = el('div',{}, el('h3',{}, 'Registered students (' + registered.length + ')'));
        registered.forEach(st => list.append(el('div',{}, st.name + ' — ' + (st.email||'—'))));
        const back = el('button',{class:'btn ghost', onclick:()=>{activeTab='courses';renderCourses()}},'Back');
        main.append(card, list, back);
      }catch(err){alert('Could not load course')}
    }

    async function viewStudent(id){
      try{
        const st = await api('/api/students/' + id);
        main.innerHTML='';
        const title = el('div',{}, el('h2',{}, st.name), el('p',{class:'sub'}, st.email||'—'));
        const regs = el('div',{}, el('h3',{}, 'Registered Courses (' + (st.registeredCourses?.length||0) + ')'));
        (st.registeredCourses||[]).forEach(rc=>{
          regs.append(el('div',{}, rc.title + ' ('+rc.code+') ', el('button',{class:'btn ghost', onclick:()=>unregister(st._id, rc.courseId)}, 'Unregister')))
        });

        // register form
        const select = el('select',{id:'select-course'});
        select.append(el('option',{value:''},'Select a course'));
        courses.forEach(c=>select.append(el('option',{value:c._id}, c.title+' — '+c.code)));
        const regBtn = el('button',{class:'btn primary', onclick:()=>{const courseId=select.value; if(!courseId) return alert('Pick a course'); register(st._id, courseId)}},'Register');

        const back = el('button',{class:'btn ghost', onclick:()=>{activeTab='students';renderStudents()}},'Back');
        main.append(title, regs, el('div',{}, select, regBtn), back);
      }catch(err){alert('Could not load student')}
    }

    async function addCourse(){
      const t = document.getElementById('new-course-title').value.trim();
      const c = document.getElementById('new-course-code').value.trim();
      if(!t||!c) return alert('title and code required');
      try{const saved = await api('/api/courses', {method:'POST', body:JSON.stringify({title:t,code:c})});
        document.getElementById('new-course-title').value='';document.getElementById('new-course-code').value='';
        await loadAll();
      }catch(err){alert('Error adding course: ' + err.message)}
    }

    async function deleteCourse(id){if(!confirm('Delete course?')) return; try{await api('/api/courses/'+id,{method:'DELETE'}); await loadAll()}catch(e){alert('Delete failed')}}

    async function addStudent(){
      const n = document.getElementById('new-student-name').value.trim();
      const e = document.getElementById('new-student-email').value.trim();
      if(!n) return alert('name required');
      try{await api('/api/students',{method:'POST',body:JSON.stringify({name:n,email:e})});document.getElementById('new-student-name').value='';document.getElementById('new-student-email').value='';await loadAll()}catch(err){alert('Error adding student')}
    }

    async function deleteStudent(id){if(!confirm('Delete student?')) return; try{await api('/api/students/'+id,{method:'DELETE'}); await loadAll()}catch(e){alert('Delete failed')}}

    async function register(studentId, courseId){try{await api(`/api/students/${studentId}/register`,{method:'POST',body:JSON.stringify({courseId})});alert('Registered'); await loadAll();}catch(e){alert('Register failed: '+e.message)}}
    async function unregister(studentId, courseId){try{await api(`/api/students/${studentId}/unregister`,{method:'POST',body:JSON.stringify({courseId})});alert('Unregistered'); await loadAll();}catch(e){alert('Unregister failed')}}

    async function seed(){if(!confirm('Seed demo data? This will wipe existing data.')) return; try{await api('/api/seed',{method:'POST'}); await loadAll(); alert('Seeded') }catch(e){alert('Seed failed')}}

    // ---- events ----
    document.getElementById('btn-seed').addEventListener('click',seed);
    document.getElementById('btn-refresh').addEventListener('click',loadAll);
    document.getElementById('btn-add-course').addEventListener('click',addCourse);
    document.getElementById('btn-add-student').addEventListener('click',addStudent);

    document.querySelectorAll('.tab').forEach(t=>t.addEventListener('click', e=>{document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); e.currentTarget.classList.add('active'); activeTab = e.currentTarget.dataset.tab; if(activeTab==='courses') renderCourses(); else renderStudents()}));

    // ---- init ----
    loadAll();
  </script>
</body>
</html>
